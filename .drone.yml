---
kind: pipeline
type: docker
name: test

steps:
  - name: testing
    image: alpine
    commands: 
      - echo "oi"
trigger:
  event:
    - push
    - pull_request
# kind: pipeline
# type: docker
# name: production

# steps:
#   - name: sending_to_prod
#     image: alpine
#     commands:
#       - apk add --no-cache git
#       - echo "DEPLOY TO PRODUCTION"
#       - echo "parent build ${DRONE_BUILD_PARENT}"
#       - echo "we're deploying to ${DRONE_DEPLOY_TO}"
#       - echo "current branch [ $(git branch) ]"
#       - >- 
#         git checkout $DRONE_DEPLOY_TO
#         PREVIOUS_MASTER=$(git rev-list -n 1 ${DRONE_DEPLOY_TO})
#         echo "PREVIOUS MASTER [ $PREVIOUS_MASTER ]"

# trigger:
#   event:
#     - promote
#     - push
#     - pull_request
#   branches:
#     - production
#   target:
#     - production
# ---
# kind: pipeline
# type: docker
# name: stagin

# steps:
#   - name: sending_to_stage
#     image: alpine
#     commands:
#       - echo "DEPLOY TO stage"

# trigger:
#   event:
#     - promote
#     - push
#     - pull_request
#   branches:
#     - stage
#   target:
#     - stage
# ---
# kind: pipeline
# type: docker
# name: tag-changes

# trigger:
#   event:
#     - tag

# steps:
#   - name: on-tags-changes
#     image: alpine
#     commands:
#       - echo "tags changes"
# ---
# kind: pipeline
# type: docker
# name: util pipeline A

# steps:
#   - name: PREF a
#     image: alpine
#     commands:
#       - echo "A"
# ---
# kind: pipeline
# type: docker
# name: util pipeline B

# steps:
#   - name: PREF b
#     image: alpine
#     commands:
#       - echo "B"
#       - sleep 9
# ---
# kind: pipeline
# type: docker
# name: tag pipeline

# steps:
#   - name: tagging stuff
#     image: animal505/ffff
#     pull: always
#     settings:
#       DRONE_BUILD_STATUS: ${DRONE_BUILD_STATUS}
---
kind: pipeline
type: kubernetes
name: tagging promotion environment

steps:
  - frontend:
    image: node
    group: build # denotes parallelism
    commands:
      - echo "node build"

  - backend:
    image: golang
    group: build  # denotes parallelism
    command:
      - echo "go build" 

# build:
#   test_example_1:
#     commands:
#       - echo "Hello World"

#   test_example_2:
#     commands:
#     - echo "World Hello"

#   test_example_3:
#     commands:
#     - echo "still behind build, running in parallel with test jobs above"

#   build_nothing:
#     deps: [test_example1, test_example_2, test_example_3]
#     commands:
#     - echo "I'm only executed after succeeded tests"

# deploy:
#   # some gce deployment plugin
#   lets_do_it:
#     image: alpine
#     commands:
#     - echo "tagging"
    
trigger:
  event:
    #- promote
    - push
  #target:
    #- production

  
